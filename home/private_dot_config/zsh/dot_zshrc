# Copyright Cameron Tuckerman-Lee 2024. All rights reserved.

# Autocompletion

if [ -d /opt/homebrew/share/zsh/site-functions ]; then
  FPATH="/opt/homebrew/share/zsh/site-functions:$FPATH"
fi

autoload -Uz compinit
compinit

autoload -U +X bashcompinit
bashcompinit

if command -v terraform &>/dev/null; then
  if [ -f /opt/homebrew/bin/terraform ]; then
    complete -o nospace -C /opt/homebrew/bin/terraform terraform
  fi
fi

if [ -d /opt/homebrew/Caskroom/google-cloud-sdk ]; then
  source /opt/homebrew/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.bash.inc
fi

if [ -f /opt/homebrew/etc/bash_completion.d/az ]; then
  source /opt/homebrew/etc/bash_completion.d/az
fi

# vim
bindkey -v
export EDITOR=vim


# history
setopt sharehistory
setopt inc_append_history
setopt extended_history
setopt hist_find_no_dups
export HISTFILE=${ZDOTDIR}/.zsh_history
export HISTFILESIZE=1000000000
export HISTSIZE=1000000000
export SAVEHIST=10000000
export HISTTIMEFORMAT="[%F %T] "

autoload -U history-search-end
zle -N history-beginning-search-backward-end history-search-end
zle -N history-beginning-search-forward-end history-search-end
bindkey "^[[A" history-beginning-search-backward-end
bindkey "^[OA" history-beginning-search-backward-end
bindkey "^[[B" history-beginning-search-forward-end
bindkey "^[OB" history-beginning-search-forward-end

#autoload -U up-line-or-beginning-search
#autoload -U down-line-or-beginning-search
#zle -N up-line-or-beginning-search
#zle -N down-line-or-beginning-search
#bindkey "^[[A" up-line-or-beginning-search
#bindkey "^[[B" down-line-or-beginning-search

# aliases
alias ll='ls -lsah'
alias blaze='bazel'
alias code-wait='code --wait'

if command -v wget &> /dev/null; then
  alias wget='wget --no-hsts'
fi

# functions
function re-source() {
  source $ZDOTDIR/.zshrc
}

for file in $HOME/.config/zsh/config.d/*; do
  source "$file"
done

# hooks (this should be last)
command -v rbenv &>/dev/null && eval "$(rbenv init - zsh)"
command -v pyenv &>/dev/null && eval "$(pyenv init -)"
command -v nodenv &>/dev/null && eval "$(nodenv init -)"
command -v direnv &>/dev/null && eval "$(direnv hook zsh)"
command -v starship &>/dev/null && eval "$(starship init zsh)"
